name: multi-dc-evpn
topology:
  nodes:
    # DC1 Spine switches
    dc1-spine1:
      kind: arista
      image: arista/ceos:latest
      mgmt-ipv4: 172.20.20.2

    dc1-spine2:
      kind: arista
      image: arista/ceos:latest
      mgmt-ipv4: 172.20.20.3

    # DC1 Leaf switches
    dc1-leaf1:
      kind: arista
      image: arista/ceos:latest
      mgmt-ipv4: 172.20.20.4

    dc1-leaf2:
      kind: arista
      image: arista/ceos:latest
      mgmt-ipv4: 172.20.20.5

    dc1-leaf3:
      kind: arista
      image: arista/ceos:latest
      mgmt-ipv4: 172.20.20.6

    dc1-leaf4:
      kind: arista
      image: arista/ceos:latest
      mgmt-ipv4: 172.20.20.7

    # DC2 Spine switches
    dc2-spine1:
      kind: arista
      image: arista/ceos:latest
      mgmt-ipv4: 172.20.20.8

    dc2-spine2:
      kind: arista
      image: arista/ceos:latest
      mgmt-ipv4: 172.20.20.9

    # DC2 Leaf switches
    dc2-leaf1:
      kind: arista
      image: arista/ceos:latest
      mgmt-ipv4: 172.20.20.10

    dc2-leaf2:
      kind: arista
      image: arista/ceos:latest
      mgmt-ipv4: 172.20.20.11

    dc2-leaf3:
      kind: arista
      image: arista/ceos:latest
      mgmt-ipv4: 172.20.20.12

    dc2-leaf4:
      kind: arista
      image: arista/ceos:latest
      mgmt-ipv4: 172.20.20.13

    # Host containers
    host1-dc1-l1:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.100.10/24 dev eth1
        - ip route add default via 192.168.100.1

    host1-dc1-l2:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.100.11/24 dev eth1
        - ip route add default via 192.168.100.1

    host1-dc1-l3:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.120.10/24 dev eth1
        - ip route add default via 192.168.120.1

    host1-dc1-l4:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.140.10/24 dev eth1
        - ip route add default via 192.168.140.1

    host1-dc2-l1:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.100.20/24 dev eth1
        - ip route add default via 192.168.100.5

    host1-dc2-l2:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.100.21/24 dev eth1
        - ip route add default via 192.168.100.6

    host1-dc2-l3:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.120.20/24 dev eth1
        - ip route add default via 192.168.120.7

    host1-dc2-l4:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.140.20/24 dev eth1
        - ip route add default via 192.168.140.8

  links:
    # DC1 Spine-Leaf
    - endpoints: ["dc1-spine1:eth1", "dc1-leaf1:eth1"]
    - endpoints: ["dc1-spine1:eth2", "dc1-leaf2:eth1"]
    - endpoints: ["dc1-spine1:eth3", "dc1-leaf3:eth1"]
    - endpoints: ["dc1-spine1:eth4", "dc1-leaf4:eth1"]

    - endpoints: ["dc1-spine2:eth1", "dc1-leaf1:eth2"]
    - endpoints: ["dc1-spine2:eth2", "dc1-leaf2:eth2"]
    - endpoints: ["dc1-spine2:eth3", "dc1-leaf3:eth2"]
    - endpoints: ["dc1-spine2:eth4", "dc1-leaf4:eth2"]

    # DC2 Spine-Leaf
    - endpoints: ["dc2-spine1:eth1", "dc2-leaf1:eth1"]
    - endpoints: ["dc2-spine1:eth2", "dc2-leaf2:eth1"]
    - endpoints: ["dc2-spine1:eth3", "dc2-leaf3:eth1"]
    - endpoints: ["dc2-spine1:eth4", "dc2-leaf4:eth1"]

    - endpoints: ["dc2-spine2:eth1", "dc2-leaf1:eth2"]
    - endpoints: ["dc2-spine2:eth2", "dc2-leaf2:eth2"]
    - endpoints: ["dc2-spine2:eth3", "dc2-leaf3:eth2"]
    - endpoints: ["dc2-spine2:eth4", "dc2-leaf4:eth2"]

    # Inter-DC Spine-Spine EVPN
    - endpoints: ["dc1-spine1:eth5", "dc2-spine1:eth5"]
    - endpoints: ["dc1-spine1:eth6", "dc2-spine2:eth5"]
    - endpoints: ["dc1-spine2:eth5", "dc2-spine1:eth6"]
    - endpoints: ["dc1-spine2:eth6", "dc2-spine2:eth6"]

    # Leaf-Host connections
    - endpoints: ["dc1-leaf1:eth3", "host1-dc1-l1:eth1"]
    - endpoints: ["dc1-leaf2:eth3", "host1-dc1-l2:eth1"]
    - endpoints: ["dc1-leaf3:eth3", "host1-dc1-l3:eth1"]
    - endpoints: ["dc1-leaf4:eth3", "host1-dc1-l4:eth1"]

    - endpoints: ["dc2-leaf1:eth3", "host1-dc2-l1:eth1"]
    - endpoints: ["dc2-leaf2:eth3", "host1-dc2-l2:eth1"]
    - endpoints: ["dc2-leaf3:eth3", "host1-dc2-l3:eth1"]
    - endpoints: ["dc2-leaf4:eth3", "host1-dc2-l4:eth1"]

mgmt:
  network: clab
  ipv4-subnet: 172.20.20.0/24
